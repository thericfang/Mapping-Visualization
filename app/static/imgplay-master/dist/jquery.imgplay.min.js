!function(e){e.imgplay=function(n,t){var i={name:"imgplay",rate:1,controls:!0},a=this,s=n,l=e(n),r=null,c=null,o=!1,u="forward",m=5,p=0,d=0,f=[],g=null;a.settings={},a.frames=[],a.init=function(){a.settings=e.extend({},i,t),a.settings.rate=a.settings.rate<.001?.001:a.settings.rate,a.settings.rate=a.settings.rate>100?100:a.settings.rate,l.addClass("imgplay"),r=e('<canvas class="imgplay-canvas">'),c=r.get(0).getContext("2d"),l.append(r),v(),l.find("img").each(function(n,t){""!=e(t).prop("src")?a.frames.push(t):f.push(t),p++}).detach(),e(window).resize(b),b()},a.play=function(){o=!0,u="forward",h()},a.pause=function(){o=!1,null!=g&&clearTimeout(g)},a.stop=function(){o=!1,d=0},a.rewind=function(e){var e=parseInt(e);e>0&&d>=e&&(u="backward",d-=e,h())},a.forward=function(e){var e=parseInt(e);e>0&&p>=d+e&&(u="forward",d+=e,h())},a.fastRewind=function(e){var e=parseInt(e);e>0&&(u="backward",a.settings.rate=e),h()},a.fastForward=function(e){var e=parseInt(e);e>0&&(u="forward",a.settings.rate=e),h()},a.previous=function(){},a.next=function(){},a.previousFrame=function(){o=!1,u="backward",d--,h()},a.nextFrame=function(){o=!1,u="forward",d++,h()},a.toFrame=function(e){e=0>e?0:e,e<frames.length&&(d=e,h())},a.fullscreen=function(e){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():s.requestFullscreen?s.requestFullscreen():s.msRequestFullscreen?s.msRequestFullscreen():s.mozRequestFullScreen?s.mozRequestFullScreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),setTimeout(function(){b()},2e3)};var v=function(){if(0==l.find(".imgplay-controls").length){var n=e('<div class="imgplay-controls"></div>'),t=e('<div class="imgplay-progress">'),i=e('<div class="imgplay-buttons">'),s=e('<div class="imgplay-load-bar">'),r=e('<div class="imgplay-play-bar">'),c=e('<div class="imgplay-button imgplay-play"><i class="material-icons">play_arrow</i></div>'),o=e('<div class="imgplay-button imgplay-pause"><i class="material-icons">pause</i></div>'),u=e('<div class="imgplay-button imgplay-stop"><i class="material-icons">stop</i></div>'),m=e('<div class="imgplay-button imgplay-previous-frame"><i class="material-icons">skip_previous</i></div>'),p=e('<div class="imgplay-button imgplay-next-frame"><i class="material-icons">skip_next</i></div>'),d=e('<div class="imgplay-button imgplay-fullscreen"><i class="material-icons">fullscreen</i></div>');c.on("click",function(){a.play()}),o.on("click",function(){a.pause()}),u.on("click",function(){a.stop()}),m.on("click",function(){a.previousFrame()}),p.on("click",function(){a.nextFrame()}),d.on("click",function(){a.fullscreen()}),s.append(r),t.append(s),i.append([c,o,m,u,p,d]),n.append([t,i]),l.append(n)}},h=function(){if(null!=c){var n=a.frames[d],t=e(n);if(n){if(t.prop("naturalHeight")>0){var i=r.width(),s=r.height(),l=n.width,p=n.height,v=0,w=0;i>=s?(v=l*(s/p),w=s):(v=i,w=p*(i/l)),c.drawImage(n,(i-v)/2,(s-w)/2,v,w)}}else if(f.length)return a.pause(),void y();if(0>d||d>a.frames.length)return void a.stop();o&&("forward"==u?(d++,d>a.frames.length-m/2&&y()):d--,g=setTimeout(h,Math.ceil(1e3/a.settings.rate))),F()}},y=function(){if(f.length)for(var e=0;m>e&&e<f.length;e++)w(e)},w=function(n){if(n<f.length){var t=f[n],i=e(t);i.data("src")&&i.on("load",function(){a.frames.push(t),f.splice(f.indexOf(t),1),F(),n==m-1&&"forward"==u&&0==o&&a.play()}).prop("src",i.data("src"))}},F=function(){var e=a.frames.length/p*100,n=d/a.frames.length*100;e=e>100?100:e,n=n>100?100:n,l.find(".imgplay-load-bar").css("width",e+"%"),l.find(".imgplay-play-bar").css("width",n+"%")},b=function(){r.prop({height:l.height(),width:l.width()})};a.init()},e.fn.imgplay=function(n){return this.each(function(){if(void 0==e(this).data("imgplay")){var t=new e.imgplay(this,n);e(this).data("imgplay",t)}})}}(jQuery);